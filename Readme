# TeslaMap

A web app that shows the last known position of your Tesla on an interactive map, powered by data from [TeslaMate](https://github.com/adriankumpf/teslamate).

## Features

- Live car position on a dark-themed Leaflet map with heading indicator
- Car selector page when multiple vehicles are in the database
- Browser geolocation to show distance and ETA from you to the car
- Route visualization between your location and the car (via OSRM)
- Battery level and speed display
- Auto-refresh: position every 1 s, route every 30 s

## Tech Stack

- **Frontend** -- Vue 3, TypeScript, Vite, Leaflet
- **Backend** -- Go 1.24, stdlib `net/http`, pgx (PostgreSQL)
- **Deploy** -- Docker multi-stage build, single static binary, Kubernetes

The Vue app is embedded into the Go binary at build time (`//go:embed`), so the final image is just one executable serving both the API and the SPA.

## Getting Started

### Prerequisites

- Go 1.24+
- Node 20+
- A PostgreSQL database populated by TeslaMate

### Environment

Copy `.env.example` and fill in your values:

```
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=teslamate_owner
DATABASE_PASS=secret
DATABASE_NAME=teslamate
DEFAULT_CAR_ID=1
PORT=8080
```

### Run locally

```bash
# Frontend dev server (proxies /api to localhost:8080)
cd frontend && npm install && npm run dev

# Backend
go run main.go
```

### Docker

```bash
docker build -t teslamap .
docker run -p 8080:8080 --env-file .env teslamap
```

## API

| Method | Endpoint          | Description                              |
|--------|-------------------|------------------------------------------|
| GET    | `/api/cars`       | List all cars                            |
| GET    | `/api/cars/{id}`  | Car details with latest position/heading |
| GET    | `/api/health`     | Health check (pings the database)        |

Full spec in [openapi.yaml](openapi.yaml).

## Project Structure

```
main.go                    # HTTP server, embeds frontend
internal/
  config/                  # Environment variable loading
  db/                      # PostgreSQL connection & queries
  handler/                 # API route handlers
  model/                   # Car and Position structs
frontend/
  src/
    views/                 # SelectCar, CarMap pages
    components/            # MapView, CarCard, DistanceInfo
    api/                   # Fetch client, types, OSRM routing
    composables/           # useGeolocation hook
```

## Deployment

CI/CD is handled by GitHub Actions (`.github/workflows/docker-publish.yml`). On push, the image is built, pushed to a Harbor registry, and the Kubernetes manifest is updated automatically.

Domain: `car.sindrema.com` (HTTPS)
